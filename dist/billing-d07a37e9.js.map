{"version":3,"file":"billing-d07a37e9.js","mappings":"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","sources":["webpack://checkout/./packages/core/src/app/billing/BillingForm.tsx","webpack://checkout/./packages/core/src/app/billing/Billing.tsx","webpack://checkout/./packages/core/src/app/billing/getBillingMethodId.ts"],"sourcesContent":["import {\n    type Address,\n    type FormField,\n} from '@bigcommerce/checkout-sdk';\nimport { type FormikProps, withFormik } from 'formik';\nimport React, { type RefObject, useRef, useState, useEffect } from 'react'; // [MTX] - import useEffect\nimport { lazy } from 'yup';\n\nimport { TranslatedString, withLanguage, type WithLanguageProps } from '@bigcommerce/checkout/locale';\nimport { useCheckout } from '@bigcommerce/checkout/payment-integration-api';\nimport { usePayPalFastlaneAddress } from '@bigcommerce/checkout/paypal-fastlane-integration';\nimport { AddressFormSkeleton, LoadingOverlay, useThemeContext } from '@bigcommerce/checkout/ui';\nimport { mtxConfig } from '../mtxConfig'; // [MTX] - import mtxConfig\n\n// [MTX] - helper per rendere non obbligatori company + P.IVA su Billing\nconst getFieldsWithPivaReadonly = (\n    getFields: (countryCode?: string) => FormField[],\n    countryCode?: string,\n): FormField[] => {\n    const fields = getFields(countryCode);\n    const pIvaId = mtxConfig.AddressCustomFields.pIvaID;\n\n    return fields.map(field => {\n        const isPivaField =\n            field.name === `field_${pIvaId}` ||\n            field.name === `customField[${pIvaId}]` ||\n            // a volte BigCommerce usa l'id puro\n            field.id === pIvaId;\n\n        const isCompanyField =\n            field.name === 'company' ||\n            field.name === 'billingAddress.company' ||\n            field.name === 'shippingAddress.company' || // safe anche se non usato qui\n            field.id === 'company';\n\n        if (isPivaField || isCompanyField) {\n            return {\n                ...field,\n                required: false,\n            };\n        }\n\n        return field;\n    });\n};\n\nimport {\n    AddressForm,\n    type AddressFormValues,\n    AddressSelect,\n    AddressType,\n    getAddressFormFieldsValidationSchema,\n    getTranslateAddressError,\n    isValidCustomerAddress,\n    mapAddressToFormValues,\n} from '../address';\nimport { EMPTY_ARRAY, isFloatingLabelEnabled as getIsFloatingLabelEnabled } from '../common/utility';\nimport { getCustomFormFieldsValidationSchema } from '../formFields';\nimport { OrderComments } from '../orderComments';\nimport { getShippableItemsCount } from '../shipping';\nimport { Button, ButtonVariant } from '../ui/button';\nimport { Fieldset, Form } from '../ui/form';\n\nimport StaticBillingAddress from './StaticBillingAddress';\n\nexport type BillingFormValues = AddressFormValues & { orderComment: string };\n\nexport interface BillingFormProps {\n    methodId?: string;\n    billingAddress?: Address;\n    customerMessage: string;\n    navigateNextStep(): void;\n    onSubmit(values: BillingFormValues): void;\n    onUnhandledError(error: Error): void;\n    getFields(countryCode?: string): FormField[];\n}\n\nconst BillingForm = ({\n    methodId,\n    getFields,\n    billingAddress,\n    setFieldValue,\n    values,\n    onUnhandledError,\n}: BillingFormProps & WithLanguageProps & FormikProps<BillingFormValues>) => {\n    const [isResettingAddress, setIsResettingAddress] = useState(false);\n    const addressFormRef: RefObject<HTMLFieldSetElement> = useRef(null);\n    const { isPayPalFastlaneEnabled, paypalFastlaneAddresses } = usePayPalFastlaneAddress();\n\n    const { themeV2 } = useThemeContext();\n    const { checkoutService, checkoutState } = useCheckout();\n\n    const {\n        data: { getCustomer, getConfig, getBillingCountries, getCart },\n        statuses: { isUpdatingBillingAddress, isUpdatingCheckout },\n    } = checkoutState;\n    const customer = getCustomer();\n    const config = getConfig();\n    const cart = getCart();\n\n    if (!config || !customer || !cart) {\n        throw new Error('checkout data is not available');\n    }\n\n    // --[MTX] -- Init --\n    const customerId = customer?.id;\n\n    const companyNameFromGroup = customer?.customerGroup?.name;\n    const companyNameFromAddress = customer?.addresses?.[0]?.company;\n\n    const companyName =\n        companyNameFromGroup ||\n        companyNameFromAddress ||\n        billingAddress?.company ||\n        '';\n\n    const [companyVat, setCompanyVat] = React.useState<string>(''); // fallback iniziale\n\n\n    useEffect(() => {\n        if (!customerId) {\n            return;\n        }\n\n        const loadCompanyVat = async () => {\n            try {\n                const url = `https://www.bigcommerceconnector.com/gem/getCompanyData.php?customerId=${customerId}`;\n\n                const res = await fetch(url, {\n                    credentials: 'include',\n                });\n\n                if (!res.ok) {\n                    throw new Error(`HTTP ${res.status}`);\n                }\n\n                const data = await res.json();\n\n                if (data.vatNumber) {\n                    setCompanyVat(data.vatNumber);\n                }\n            } catch (error) {\n                console.error('[MTX] - errore caricando P.IVA da backend', error);\n            }\n        };\n\n        loadCompanyVat();\n    }, [customerId]);\n\n    useEffect(() => {\n        const pIvaId = mtxConfig.AddressCustomFields.pIvaID;\n        const pIvaInputId = `field_${pIvaId}Input`; // es: field_30Input\n\n        const intervalId = window.setInterval(() => {\n            // --- P.IVA ---\n            const pivaInput = document.getElementById(pIvaInputId) as HTMLInputElement | null;\n\n            if (pivaInput) {\n                pivaInput.readOnly = true;\n\n                // allinea sempre il valore alla P.IVA aziendale\n                if (companyVat && pivaInput.value !== companyVat) {\n                    pivaInput.value = companyVat;\n                }\n\n                pivaInput.style.backgroundColor = '#f4f4f4';\n                pivaInput.style.cursor = 'not-allowed';\n            }\n\n\n            // --- COMPANY / AZIENDA ---\n            const companyInput = document.querySelector<HTMLInputElement>(\n                'input[name=\"shippingAddress.company\"], input[name=\"company\"]',\n            );\n\n            if (companyInput) {\n                companyInput.readOnly = true;\n\n                // allinea sempre il valore al companyName risolto dal customer\n                if (companyName && companyInput.value !== companyName) {\n                    companyInput.value = companyName;\n                }\n\n                companyInput.style.backgroundColor = '#f4f4f4';\n                companyInput.style.cursor = 'not-allowed';\n            }\n\n            // se abbiamo settato almeno uno dei due, possiamo fermare l'intervallo\n            if (pivaInput || companyInput) {\n                window.clearInterval(intervalId);\n            }\n        }, 300);\n\n        return () => {\n            window.clearInterval(intervalId);\n        };\n    }, [companyName, companyVat]);\n\n    // --[MTX] -- End --\n\n    const isGuest = customer.isGuest;\n    const addresses = customer.addresses;\n    const shouldRenderStaticAddress = methodId === 'amazonpay';\n    const allFormFields = getFieldsWithPivaReadonly(getFields, values.countryCode);\n    const customFormFields = allFormFields.filter(({ custom }) => custom);\n    const hasCustomFormFields = customFormFields.length > 0;\n    const editableFormFields =\n        shouldRenderStaticAddress && hasCustomFormFields ? customFormFields : allFormFields;\n    const billingAddresses = isGuest && isPayPalFastlaneEnabled ? paypalFastlaneAddresses : addresses;\n    const hasAddresses = billingAddresses?.length > 0;\n    const hasValidCustomerAddress =\n        billingAddress &&\n        isValidCustomerAddress(\n            billingAddress,\n            billingAddresses,\n            getFieldsWithPivaReadonly(getFields, billingAddress.countryCode),\n        );\n    const isUpdating = isUpdatingBillingAddress() || isUpdatingCheckout();\n    const { enableOrderComments } = config.checkoutSettings;\n    const shouldShowOrderComments = enableOrderComments && getShippableItemsCount(cart) < 1;\n\n    const handleSelectAddress = async (address: Partial<Address>) => {\n        setIsResettingAddress(true);\n\n        try {\n            await checkoutService.updateBillingAddress(address);\n        } catch (error) {\n            if (error instanceof Error) {\n                onUnhandledError(error);\n            }\n        } finally {\n            setIsResettingAddress(false);\n        }\n    };\n\n    const handleUseNewAddress = () => {\n        void handleSelectAddress({});\n    };\n\n    // Below should be removed once <AddressForm /> is able to reduce prop drilling\n    const countries = getBillingCountries() || EMPTY_ARRAY;\n    const countriesWithAutocomplete = ['US', 'CA', 'AU', 'NZ', 'GB'];\n    const { googleMapsApiKey } = config.checkoutSettings;\n    const isFloatingLabelEnabled = getIsFloatingLabelEnabled(config.checkoutSettings)\n\n    return (\n        <Form autoComplete=\"on\">\n            {shouldRenderStaticAddress && billingAddress && (\n                <div className=\"form-fieldset\">\n                    <StaticBillingAddress address={billingAddress} />\n                </div>\n            )}\n\n            <Fieldset id=\"checkoutBillingAddress\" ref={addressFormRef}>\n                {hasAddresses && !shouldRenderStaticAddress && (\n                    <Fieldset id=\"billingAddresses\">\n                        <LoadingOverlay isLoading={isResettingAddress}>\n                            <AddressSelect\n                                addresses={billingAddresses}\n                                onSelectAddress={handleSelectAddress}\n                                onUseNewAddress={handleUseNewAddress}\n                                selectedAddress={\n                                    hasValidCustomerAddress ? billingAddress : undefined\n                                }\n                                type={AddressType.Billing}\n                            />\n                        </LoadingOverlay>\n                    </Fieldset>\n                )}\n\n                {!hasValidCustomerAddress && (\n                    <AddressFormSkeleton isLoading={isResettingAddress}>\n                        <AddressForm\n                            countries={countries}\n                            countriesWithAutocomplete={countriesWithAutocomplete}\n                            countryCode={values.countryCode}\n                            formFields={editableFormFields}\n                            googleMapsApiKey={googleMapsApiKey}\n                            isFloatingLabelEnabled={isFloatingLabelEnabled}\n                            setFieldValue={setFieldValue}\n                            shouldShowSaveAddress={!isGuest}\n                        />\n                    </AddressFormSkeleton>\n                )}\n            </Fieldset>\n\n            {shouldShowOrderComments && <OrderComments />}\n\n            <div className=\"form-actions\">\n                <Button\n                    className={themeV2 ? 'body-bold' : ''}\n                    disabled={isUpdating || isResettingAddress}\n                    id=\"checkout-billing-continue\"\n                    isLoading={isUpdating || isResettingAddress}\n                    type=\"submit\"\n                    variant={ButtonVariant.Primary}\n                >\n                    <TranslatedString id=\"common.continue_action\" />\n                </Button>\n            </div>\n        </Form>\n    );\n};\n\nexport default withLanguage(\n    withFormik<BillingFormProps & WithLanguageProps, BillingFormValues>({\n        handleSubmit: (values, { props: { onSubmit } }) => {\n            onSubmit(values);\n        },\n        mapPropsToValues: ({ getFields, customerMessage, billingAddress }) => ({\n            ...mapAddressToFormValues(\n                getFieldsWithPivaReadonly(\n                    getFields,\n                    billingAddress && billingAddress.countryCode,\n                ),\n                billingAddress,\n            ),\n            orderComment: customerMessage,\n        }),\n        isInitialValid: ({ billingAddress, getFields, language }) =>\n            !!billingAddress &&\n            getAddressFormFieldsValidationSchema({\n                language,\n                formFields: getFieldsWithPivaReadonly(\n                    getFields,\n                    billingAddress.countryCode,\n                ),\n            }).isValidSync(billingAddress),\n        validationSchema: ({\n            language,\n            getFields,\n            methodId,\n        }: BillingFormProps & WithLanguageProps) =>\n            methodId === 'amazonpay'\n                ? lazy<Partial<AddressFormValues>>((values) =>\n                    getCustomFormFieldsValidationSchema({\n                        translate: getTranslateAddressError(language),\n                        formFields: getFieldsWithPivaReadonly(\n                            getFields,\n                            values && values.countryCode,\n                        ),\n                    }),\n                )\n                : lazy<Partial<AddressFormValues>>((values) =>\n                    getAddressFormFieldsValidationSchema({\n                        language,\n                        formFields: getFieldsWithPivaReadonly(\n                            getFields,\n                            values && values.countryCode,\n                        ),\n                    }),\n                ),\n        enableReinitialize: true,\n    })(BillingForm),\n);\n","import type { CheckoutSelectors } from '@bigcommerce/checkout-sdk';\nimport React, { type ReactElement, useEffect } from 'react';\n\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\nimport {\n    useCheckout,\n} from '@bigcommerce/checkout/payment-integration-api';\nimport { AddressFormSkeleton, useThemeContext } from '@bigcommerce/checkout/ui';\n\nimport { isEqualAddress, mapAddressFromFormValues } from '../address';\nimport { Legend } from '../ui/form';\n\nimport BillingForm, { type BillingFormValues } from './BillingForm';\nimport getBillingMethodId from './getBillingMethodId';\n\ninterface BillingProps {\n    navigateNextStep(): void;\n    onReady(): void;\n    onUnhandledError(error: Error): void;\n}\n\nconst Billing = ({navigateNextStep, onReady, onUnhandledError}:BillingProps): ReactElement => {\n    const { checkoutService, checkoutState } = useCheckout();\n    const { themeV2 }  = useThemeContext();\n\n    const {\n        data: {\n            getCheckout,\n            getConfig,\n            getCart,\n            getCustomer,\n            getBillingAddress,\n            getBillingAddressFields,\n        },\n        statuses: { isLoadingBillingCountries },\n    } = checkoutState;\n    const config = getConfig();\n    const customer = getCustomer();\n    const checkout = getCheckout();\n    const cart = getCart();\n\n    if (!config || !customer || !checkout || !cart) {\n        throw new Error('Unable to access checkout data')\n    }\n\n    const isInitializing  = isLoadingBillingCountries();\n\n    // Below constants are for <BillingForm />'s HOC props\n    const customerMessage  = checkout.customerMessage;\n    const methodId  = getBillingMethodId(checkout);\n    const billingAddress  = getBillingAddress();\n    const getFields  = getBillingAddressFields;\n    const handleSubmit = async ({\n                                    orderComment,\n                                    ...addressValues\n                                }: BillingFormValues):Promise<void> => {\n        const updateAddress  = checkoutService.updateBillingAddress;\n        const updateCheckout  = checkoutService.updateCheckout;\n        const billingAddress  = getBillingAddress();\n        const promises: Array<Promise<CheckoutSelectors>> = [];\n        const address = mapAddressFromFormValues(addressValues);\n\n        if (address && !isEqualAddress(address, billingAddress)) {\n            promises.push(updateAddress(address));\n        }\n\n        if (customerMessage !== orderComment) {\n            promises.push(updateCheckout({ customerMessage: orderComment }));\n        }\n\n        try {\n            await Promise.all(promises);\n\n            navigateNextStep();\n        } catch (error) {\n            if (error instanceof Error) {\n                onUnhandledError(error);\n            }\n        }\n    };\n\n    useEffect(() => {\n        const init = async () => {\n            try {\n                await checkoutService.loadBillingAddressFields();\n                onReady();\n            } catch (error) {\n                if (error instanceof Error) {\n                    onUnhandledError(error);\n                }\n            }\n        }\n\n        void init();\n    }, []);\n\n    return (\n        <AddressFormSkeleton isLoading={isInitializing}>\n            <div className=\"checkout-form\">\n                <div className=\"form-legend-container\">\n                    <Legend testId=\"billing-address-heading\" themeV2={themeV2}>\n                        <TranslatedString id=\"billing.billing_address_heading\" />\n                    </Legend>\n                </div>\n                <BillingForm\n                    billingAddress={billingAddress}\n                    customerMessage={customerMessage}\n                    getFields={getFields}\n                    methodId={methodId}\n                    navigateNextStep={navigateNextStep}\n                    onSubmit={handleSubmit}\n                    onUnhandledError={onUnhandledError}\n                />\n            </div>\n        </AddressFormSkeleton>\n    );\n}\n\nexport default Billing;\n","import { type Checkout } from '@bigcommerce/checkout-sdk';\n\nimport { getPreselectedPayment } from '../payment';\n\nexport default function getBillingMethodId(checkout: Checkout): string | undefined {\n    const BILLING_METHOD_IDS = ['amazonpay'];\n    const preselectedPayment = getPreselectedPayment(checkout);\n\n    return preselectedPayment && BILLING_METHOD_IDS.includes(preselectedPayment.providerId)\n        ? preselectedPayment.providerId\n        : undefined;\n}\n"],"names":["getFieldsWithPivaReadonly","getFields","countryCode","fields","pIvaId","mtxConfig","AddressCustomFields","pIvaID","map","field","isPivaField","name","id","isCompanyField","required","withLanguage","handleSubmit","values","props","onSubmit","mapPropsToValues","customerMessage","billingAddress","mapAddressToFormValues","orderComment","isInitialValid","language","getAddressFormFieldsValidationSchema","formFields","isValidSync","validationSchema","methodId","getCustomFormFieldsValidationSchema","translate","enableReinitialize","setFieldValue","onUnhandledError","isResettingAddress","setIsResettingAddress","useState","addressFormRef","useRef","isPayPalFastlaneEnabled","paypalFastlaneAddresses","usePayPalFastlaneAddress","themeV2","checkoutService","checkoutState","data","getCustomer","getConfig","getBillingCountries","getCart","statuses","isUpdatingBillingAddress","isUpdatingCheckout","customer","config","cart","Error","customerId","companyNameFromGroup","customerGroup","companyNameFromAddress","addresses","company","companyName","companyVat","setCompanyVat","useEffect","url","res","fetch","credentials","ok","status","json","vatNumber","error","console","pIvaInputId","intervalId","window","setInterval","pivaInput","document","getElementById","readOnly","value","style","backgroundColor","cursor","companyInput","querySelector","clearInterval","isGuest","shouldRenderStaticAddress","allFormFields","customFormFields","filter","custom","hasCustomFormFields","length","editableFormFields","billingAddresses","hasAddresses","hasValidCustomerAddress","isValidCustomerAddress","isUpdating","enableOrderComments","checkoutSettings","shouldShowOrderComments","getShippableItemsCount","handleSelectAddress","address","updateBillingAddress","countries","googleMapsApiKey","isFloatingLabelEnabled","Form","autoComplete","className","StaticBillingAddress","Fieldset","ref","LoadingOverlay","isLoading","AddressSelect","A","onSelectAddress","onUseNewAddress","selectedAddress","undefined","type","AddressType","Billing","AddressFormSkeleton","AddressForm","countriesWithAutocomplete","shouldShowSaveAddress","OrderComments","Button","disabled","variant","Primary","TranslatedString","navigateNextStep","onReady","getCheckout","getBillingAddress","getBillingAddressFields","isLoadingBillingCountries","checkout","isInitializing","preselectedPayment","getPreselectedPayment","includes","providerId","getBillingMethodId","loadBillingAddressFields","Legend","testId","addressValues","updateAddress","updateCheckout","promises","mapAddressFromFormValues","isEqualAddress","push","Promise","all"],"sourceRoot":""}