"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[8964],{44713:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var o=n(31635),s=n(70355),a=n(49655),i=n(39981),d=n(69022),r=n(17986),l=n(39886),c=n(95108),u=n(43586),m=n(69462),g=n(94202),p=n(68512),A=n(38989),v=n(68801),h=n(63936),y=n(87650),f=n(49102),b=n(62562),E=n(17907),C=n(22011),w=n(33515),k=n(79001),S=n(84559),F=n(10685),I=n(69070),_=n(74027),B=n(46487),N=n(4899),O=n(60833),U=n(74302);const V=(e,t)=>{const n=e(t),o=h.O.AddressCustomFields.pIvaID;return n.map((e=>{const t=e.name===`field_${o}`||e.name===`customField[${o}]`||e.id===o,n="company"===e.name||"billingAddress.company"===e.name||"shippingAddress.company"===e.name||"company"===e.id;return t||n?Object.assign(Object.assign({},e),{required:!1}):e}))},M=(0,p.A)((0,m.bk)({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,customerMessage:t,billingAddress:n})=>Object.assign(Object.assign({},(0,C.A)(V(e,n&&n.countryCode),n)),{orderComment:t}),isInitialValid:({billingAddress:e,getFields:t,language:n})=>!!e&&(0,w.A)({language:n,formFields:V(t,e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:n})=>"amazonpay"===n?(0,g.RZ)((n=>(0,F.A)({translate:(0,w.X)(e),formFields:V(t,n&&n.countryCode)}))):(0,g.RZ)((n=>(0,w.A)({language:e,formFields:V(t,n&&n.countryCode)}))),enableReinitialize:!0})((({methodId:e,getFields:t,billingAddress:n,setFieldValue:l,values:c,onUnhandledError:u})=>{var m,g,p;const[C,w]=(0,s.useState)(!1),F=(0,s.useRef)(null),{isPayPalFastlaneEnabled:M,paypalFastlaneAddresses:P}=(0,A.A)(),{themeV2:L}=(0,d.w)(),{checkoutService:j,checkoutState:R}=(0,i.Q)(),{data:{getCustomer:$,getConfig:z,getBillingCountries:T,getCart:D},statuses:{isUpdatingBillingAddress:G,isUpdatingCheckout:Z}}=R,q=$(),x=z(),J=D();if(!x||!q||!J)throw new Error("checkout data is not available");const K=null==q?void 0:q.id,Q=null===(m=null==q?void 0:q.customerGroup)||void 0===m?void 0:m.name,X=null===(p=null===(g=null==q?void 0:q.addresses)||void 0===g?void 0:g[0])||void 0===p?void 0:p.company,H=Q||X||(null==n?void 0:n.company)||"",[W,Y]=s.useState("");(0,s.useEffect)((()=>{if(!K)return;(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{const e=`https://www.bigcommerceconnector.com/gem/getCompanyData.php?customerId=${K}`,t=yield fetch(e,{credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=yield t.json();n.vatNumber&&Y(n.vatNumber)}catch(e){console.error("[MTX] - errore caricando P.IVA da backend",e)}}))}),[K]),(0,s.useEffect)((()=>{const e=`field_${h.O.AddressCustomFields.pIvaID}Input`,t=window.setInterval((()=>{const n=document.getElementById(e);n&&(n.readOnly=!0,W&&n.value!==W&&(n.value=W),n.style.backgroundColor="#f4f4f4",n.style.cursor="not-allowed");const o=document.querySelector('input[name="shippingAddress.company"], input[name="company"]');o&&(o.readOnly=!0,H&&o.value!==H&&(o.value=H),o.style.backgroundColor="#f4f4f4",o.style.cursor="not-allowed"),(n||o)&&window.clearInterval(t)}),300);return()=>{window.clearInterval(t)}}),[H,W]);const ee=q.isGuest,te=q.addresses,ne="amazonpay"===e,oe=V(t,c.countryCode),se=oe.filter((({custom:e})=>e)),ae=se.length>0,ie=ne&&ae?se:oe,de=ee&&M?P:te,re=(null==de?void 0:de.length)>0,le=n&&(0,y.A)(n,de,V(t,n.countryCode)),ce=G()||Z(),{enableOrderComments:ue}=x.checkoutSettings,me=ue&&(0,_.A)(J)<1,ge=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){w(!0);try{yield j.updateBillingAddress(e)}catch(e){e instanceof Error&&u(e)}finally{w(!1)}})),pe=T()||k.M,{googleMapsApiKey:Ae}=x.checkoutSettings,ve=(0,S.A)(x.checkoutSettings);return s.createElement(N.A,{autoComplete:"on"},ne&&n&&s.createElement("div",{className:"form-fieldset"},s.createElement(U.A,{address:n})),s.createElement(O.A,{id:"checkoutBillingAddress",ref:F},re&&!ne&&s.createElement(O.A,{id:"billingAddresses"},s.createElement(v.A,{isLoading:C},s.createElement(f.A,{addresses:de,onSelectAddress:ge,onUseNewAddress:()=>{ge({})},selectedAddress:le?n:void 0,type:b.A.Billing}))),!le&&s.createElement(r.A,{isLoading:C},s.createElement(E.A,{countries:pe,countriesWithAutocomplete:["US","CA","AU","NZ","GB"],countryCode:c.countryCode,formFields:ie,googleMapsApiKey:Ae,isFloatingLabelEnabled:ve,setFieldValue:l,shouldShowSaveAddress:!ee}))),me&&s.createElement(I.A,null),s.createElement("div",{className:"form-actions"},s.createElement(B.Ay,{className:L?"body-bold":"",disabled:ce||C,id:"checkout-billing-continue",isLoading:ce||C,type:"submit",variant:B.Ak.Primary},s.createElement(a.A,{id:"common.continue_action"}))))})));var P=n(21106);const L=({navigateNextStep:e,onReady:t,onUnhandledError:n})=>{const{checkoutService:m,checkoutState:g}=(0,i.Q)(),{themeV2:p}=(0,d.w)(),{data:{getCheckout:A,getConfig:v,getCart:h,getCustomer:y,getBillingAddress:f,getBillingAddressFields:b},statuses:{isLoadingBillingCountries:E}}=g,C=v(),w=y(),k=A(),S=h();if(!(C&&w&&k&&S))throw new Error("Unable to access checkout data");const F=E(),I=k.customerMessage,_=function(e){const t=(0,P.A)(e);return t&&["amazonpay"].includes(t.providerId)?t.providerId:void 0}(k),B=f(),N=b;return(0,s.useEffect)((()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m.loadBillingAddressFields(),t()}catch(e){e instanceof Error&&n(e)}}))}),[]),s.createElement(r.A,{isLoading:F},s.createElement("div",{className:"checkout-form"},s.createElement("div",{className:"form-legend-container"},s.createElement(u.A,{testId:"billing-address-heading",themeV2:p},s.createElement(a.A,{id:"billing.billing_address_heading"}))),s.createElement(M,{billingAddress:B,customerMessage:I,getFields:N,methodId:_,navigateNextStep:e,onSubmit:t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var{orderComment:s}=t,a=(0,o.__rest)(t,["orderComment"]);const i=m.updateBillingAddress,d=m.updateCheckout,r=f(),u=[],g=(0,l.A)(a);g&&!(0,c.A)(g,r)&&u.push(i(g)),I!==s&&u.push(d({customerMessage:s}));try{yield Promise.all(u),e()}catch(e){e instanceof Error&&n(e)}})),onUnhandledError:n})))}}}]);
//# sourceMappingURL=billing-d07a37e9.js.map